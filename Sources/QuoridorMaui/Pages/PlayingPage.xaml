<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:views="clr-namespace:QuoridorMaui.Views"
             xmlns:mylayouts="clr-namespace:QuoridorMaui.MyLayouts"
             x:Class="QuoridorMaui.Pages.PlayingPage"
             Title="Partie"
             BackgroundColor="White"
             xmlns:Manager="clr-namespace:QuoridorLib.Interfaces;assembly=QuoridorLib">
    <ContentPage.Resources>
        <Style TargetType="Label" >
            <Setter Property="TextColor" Value="{StaticResource colorPlayersTest}"/>
            <Setter Property="FontSize" Value="30"/>
            <Setter Property="TextDecorations" Value="Underline"/>
        </Style>
        <ResourceDictionary>
            <x:Double x:Key="VerticalSpacing">2</x:Double>
            <x:Double x:Key="HorizontalSpacing">2</x:Double>
            <DataTemplate x:Key="cellTemplate">
                <Grid>
                    <Border x:Name="TopBorder" Stroke="Transparent" StrokeThickness="1" BackgroundColor="Transparent" HeightRequest="2" VerticalOptions="Start" HorizontalOptions="Fill"/>
                    <Border x:Name="BottomBorder" Stroke="Transparent" StrokeThickness="1" BackgroundColor="Transparent" HeightRequest="2" VerticalOptions="End" HorizontalOptions="Fill"/>
                    <Border x:Name="LeftBorder" Stroke="Transparent" StrokeThickness="1" BackgroundColor="Transparent" WidthRequest="2" HorizontalOptions="Start" VerticalOptions="Fill"/>
                    <Border x:Name="RightBorder" Stroke="Transparent" StrokeThickness="1" BackgroundColor="Transparent" WidthRequest="2" HorizontalOptions="End" VerticalOptions="Fill"/>
                    <Border Stroke="Transparent" BackgroundColor="BurlyWood" ZIndex="-1">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnCellTapped"/>
                    </Border.GestureRecognizers>
                    <Label Text="{Binding Symbol}"
                           TextColor="{Binding Color, FallbackValue=Black}"
                           FontSize="20"
                           FontAttributes="Bold"
                           HorizontalOptions="Fill"
                           VerticalOptions="Fill"
                           HorizontalTextAlignment="Center"
                           VerticalTextAlignment="Center"/>
                </Border>
                </Grid>
            </DataTemplate>
        </ResourceDictionary>
    </ContentPage.Resources>
    <Grid ColumnDefinitions="3*,*,9*,*,3*"
          RowDefinitions="4*,2*,9*,2*,2*">
        <!-- Image de fond -->
        <Image Source="homepagebackground.png"
               Aspect="AspectFill"
               Opacity="0.8"
               Grid.RowSpan="10" Grid.ColumnSpan="10"/>

        <Label x:Name="Player1Label" Text="{Binding Parameters.Player1Name}" TextColor="{Binding Player1Color}" Style="{StaticResource centeredText}"/>
        <VerticalStackLayout Grid.Column="2" Grid.Row="0" 
                            VerticalOptions="Center" 
                            HorizontalOptions="Center" 
                            Spacing="10">
            <views:Bouton Texte="pause" Clicked="Pause_Clicked"/>
            <views:Bouton x:Name="WallButton" Texte="Mur" Clicked="Wall_Clicked"/>
            <views:Bouton x:Name="OrientationButton" Texte="Vertical" Clicked="Orientation_Clicked"/>
        </VerticalStackLayout>
        <HorizontalStackLayout Grid.Row="1" Style="{StaticResource centeredHorizontalSL}">
            <Label Text="Murs restants : " FontSize="20" TextColor="{Binding Player1Color}"/>
            <Label x:Name="Walls1Label" Text="{Binding Parameters.NumberOfWalls}" FontSize="20" TextColor="{Binding Player1Color}"/>
        </HorizontalStackLayout>
        <Grid Grid.Column="0" Grid.Row="2" ColumnDefinitions="2*,*">
            <Image Source="bouton.png" Margin="2,5" Aspect="AspectFill"/>
            <ScrollView>
                <VerticalStackLayout Margin="5,10">
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                </VerticalStackLayout>
            </ScrollView>
        </Grid>
        
        <!-- Indicateur du joueur courant -->
        <Label x:Name="CurrentPlayerLabel"
               Grid.Row="1" Grid.Column="2"
               Text="{Binding CurrentPlayerName}"
               TextColor="{Binding CurrentPlayerColor}"
               FontSize="28"
               FontAttributes="Bold"
               HorizontalOptions="Center"
               VerticalOptions="End"
               Margin="0,0,0,10"/>
        <!-- Plateau de jeu -->
        <Border x:Name="GameBoardFrame" Grid.Row="2" Grid.Column="2" 
               Stroke="Black" 
               Padding="10" 
               BackgroundColor="DarkRed"
               StrokeShape="RoundRectangle 10"
               HorizontalOptions="Center"
               VerticalOptions="Center">
            <mylayouts:MatrixLayout 
                BindableLayout.ItemsSource="{Binding GameBoard.FlatMatrix}"
                BindableLayout.ItemTemplate="{StaticResource cellTemplate}"
                NbColumns="{Binding GameBoard.NbColumns}"
                NbRows="{Binding GameBoard.NbRows}"
                HorizontalSpacing="{StaticResource HorizontalSpacing}"
                VerticalSpacing="{StaticResource VerticalSpacing}"
                HorizontalOptions="Fill"
                VerticalOptions="Fill"/>
        </Border>

        <Label x:Name="Player2Label" Grid.Column="4" Text="{Binding Parameters.Player2Name}" TextColor="{Binding Player2Color}" Style="{StaticResource centeredText}"/>
        <HorizontalStackLayout Grid.Column="4" Grid.Row="1" Style="{StaticResource centeredHorizontalSL}">
            <Label Text="Murs restants :" FontSize="20" TextColor="{Binding Player2Color}"/>
            <Label x:Name="Walls2Label" Text="{Binding Parameters.NumberOfWalls}" TextColor="{Binding Player2Color}" FontSize="20"/>
        </HorizontalStackLayout>
        <Grid Grid.Column="4" Grid.Row="2" ColumnDefinitions="*,2*">
            <Image Source="bouton.png" Grid.RowSpan="10" Grid.Column="1" Aspect="AspectFill"/>
            <ScrollView Grid.Column="1">
                <VerticalStackLayout Margin="5,10">
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                    <Image Source="boutonliste.png" Grid.Row="0" Margin="0,5"/>
                </VerticalStackLayout>
            </ScrollView>
        </Grid>
    </Grid>
</ContentPage>